module "postgres" {
  # https://registry.terraform.io/modules/GoogleCloudPlatform/sql-db/google/2.0.0/submodules/postgresql
  source  = "GoogleCloudPlatform/sql-db/google//modules/postgresql"
  version = "2.0.0"

  name             = "postgres"
  database_version = "POSTGRES_9_6"
  region           = "northamerica-northeast1"
  project_id       = google_project.project.project_id
  zone             = "a"

  availability_type              = "ZONAL" # "REGIONAL"
  read_replica_availability_type = "ZONAL" # "REGIONAL"

  tier = "db-f1-micro"

  db_name   = "default"
  user_name = "default"
  # password for the default user. If not set, a random one will be generated and 
  # available in the generated_user_password output variable.
  # user_password = "default"

  backup_configuration = {
    binary_log_enabled = false
    enabled            = true
    start_time         = "01:00"
  }

  ip_configuration = {
    ipv4_enabled    = false
    require_ssl     = false
    private_network = google_compute_network.vpc.self_link
    authorized_networks = [{
      name  = "gke"
      value = module.us_west1_network.subnetwork.ip_cidr_range
    }]
  }

  read_replica_size = 0
  read_replica_tier = "db-f1-micro"

  read_replica_ip_configuration = {
    ipv4_enabled    = false
    require_ssl     = false
    private_network = google_compute_network.vpc.self_link
    authorized_networks = [{
      name  = "gke"
      value = module.us_west1_network.subnetwork.ip_cidr_range
    }]
  }
}
